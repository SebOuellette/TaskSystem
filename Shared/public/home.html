<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
      }

      #data-table {
        height: 500px;
        width: 100%;
      }

      .container {
        background-color: #f2f2f2;
        border-radius: 10px;
        padding: 20px;
        margin: 20px;
        display: flex;
        flex-direction: column;
        max-width: 1800px;
      }

      .header {
        text-align: right;
        margin-right: 20px;
        display: inline;
        float: right;
      }

      /* New styles for the bottom half */
      .bottom-half {
        display: flex;
        flex: 1;
        justify-content: space-between;
        align-items: stretch;
        margin-top: 20px;
      }

      .column {
        flex: 1;
        display: flex;
        flex-direction: column;
        margin-right: 10px;
      }

      .column2 {
        flex: 1;
        display: flex;
        flex-direction: column;
        margin-right: 10px;
        max-width: 130px !important;
      }

      .row {
        flex: 1;
        display: flex;
        margin-bottom: 10px;
        flex-direction: column;
      }

      .row input,
      .row textarea {
        flex: 1;
        border: none;
        padding: 10px;
        border-radius: 5px;
        margin-right: 10px;
      }

      .row textarea {
        resize: none; /* Disable resizing of the textarea */
        height: 200px; /* Set the height to 200px */
      }

      .row select,
      .row button {
        margin-left: 10px;
        border: none;
        padding: 10px;
        border-radius: 5px;
        cursor: pointer;
        background-color: #6b9ce5;
        color: #ffffff;
      }

      /* Set max height for the Part dropdown */
      .row select {
        max-height: 70px;
      }

      .task-list-container {
        background-color: #f2f2f2; /* Container background color */
        border-radius: 10px;
        padding: 20px;
        margin: 20px;

        overflow-y: auto;
      }

      .scrollingTable {
        width: 30em;
        overflow-y: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        border: none; /* Remove the border */
      }

      th,
      td {
        text-align: center;
        padding: 8px;
        border: none; /* Remove the border */
      }

      th {
        background-color: #f2f2f2;
      }

      .button-style {
        background-color: #ffffff;
        border: none;
        padding: 0;
        margin: 0;
        cursor: pointer;
        font-size: 100%;
        text-decoration: underline; /* Optional: Add underline for a cleaner look */
      }

      .task-list-container table {
        table-layout: fixed;
        width: 100%; /* Ensure the table takes 100% width */
      }
      .task-list-container td {
        border: none;
        height: 40px;
        overflow: hidden;
        text-overflow: ellipsis;
        background-color: #ffffff;
        font-size: 100%;
      }

      .task-list-container th.buttons,
      .task-list-container td.buttons {
        text-align: center;
        padding: 8px;
        border: none;
        width: 3%;
        max-width: 76px; /* Restrict the max width */
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .task-list-container th.title,
      .task-list-container td.title {
        text-align: center;
        padding: 8px;
        border: none;
        width: 30%;
        max-width: 200px; /* Restrict the max width */
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .assigned {
        width: 6%;
        max-width: 100px; /* Restrict the max width */
        overflow: hidden;
        text-overflow: ellipsis;
      }

      /* Style the buttons that are used to open and close the accordion panel */
      .accordion {
        cursor: pointer;
        padding: 18px;
        width: 100%;
        text-align: left;
        border: none;
        outline: none;
        transition: 0.4s;
        background-color: #ffffff !important;
      }

      /* Add a background color to the button if it is clicked on (add the .active class with JS), and when you move the mouse over it (hover) */
      .active,
      .accordion:hover {
        background-color: #ccc;
      }

      /* Style the accordion panel. Note: hidden by default */
      .panel {
        padding: 0 18px;
        background-color: white;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.2s ease-out !important;
      }

      .accordion:after {
        content: "\02795"; /* Unicode character for "plus" sign (+) */
        font-size: 13px;
        float: right;
        margin-left: 5px;
      }

      .active:after {
        content: "\2796"; /* Unicode character for "minus" sign (-) */
      }

      #myInput {
        background-image: url("/css/searchicon.png"); /* Add a search icon to input */
        background-position: 10px 12px; /* Position the search icon */
        background-repeat: no-repeat; /* Do not repeat the icon image */
        width: 50%;
        display: inline-block;
        font-size: 16px;
        padding: 12px 20px 12px 40px;
        border: 1px solid #ddd;
        margin-bottom: 12px; /* Add some space below the input */
        margin-left: 230px;
      }
    </style>
    <script type="text/javascript">
      // function to implement vertical table scrolling
      function makeTableScroll() {
        var maxRows = 20;

        var table = document.getElementById("html-data-table");
        var wrapper = table.parentNode;
        var rowsInTable = table.rows.length;
        var height = 0;
        if (rowsInTable > maxRows) {
          for (var i = 0; i < maxRows; i++) {
            height += table.rows[i].clientHeight;
          }
          wrapper.style.height = height + "px";
        }
      }
    </script>
    <title>Task Management</title>
  </head>
  <body onload="makeTableScroll();">
    <div style="margin-bottom: 20px"></div>
    <h2 style="margin-left: 20px; display: inline">Maintenance Tasks</h2>
    <div class="header">
      <a href="http://127.0.0.1:8080/help">Help?</a>
    </div>

    <div class="container">
      <div id="task" class="bottom-half" taskid="1">
        <div class="column">
          <div class="row">
            <input
              type="text"
              id="title"
              name="title"
              placeholder="Enter title"
            />
          </div>
          <div class="row">
            <textarea
              id="description"
              name="description"
              placeholder="Enter description"
            ></textarea>
          </div>
        </div>
        <div class="column2">
          <div class="row">
            <span style="margin-bottom: 5px" id="Partlable">Part</span>
            <select id="Part">
              <option partid="Part1" partnumber="SN">Part 1</option>
              <option partid="Part2">Part 2</option>
              <option partid="Part3">Part 3</option>
            </select>
            <span
              style="margin-top: 10px; margin-bottom: 5px"
              id="assignedlable"
              >Assignee</span
            >
            <select id="asignusers" aria-placeholder="assigned">
              <option value="Part1">Zebadiah</option>
              <option value="Part2">Tom</option>
              <option value="Part3">Kiana</option>
              <option value="Part4">Sebastion</option>
              <option value="Part5">N/A</option>
            </select>
          </div>
          <div class="row">
            <button type="submit" onclick="submitReport()">Submit</button>
          </div>
        </div>
      </div>
    </div>

    <h2 style="margin-left: 20px; display: inline">Task List</h2>
    <input type="text" id="myInput" placeholder="Search for names.." />
    <div class="task-list-container" style="overflow-x: auto">
      <table id="html-data-table" style="overflow-y: scroll">
        <thead>
          <tr>
            <th class="title">Title</th>
            <th>Description</th>
            <th>Part</th>
            <th class="assigned">Assigned</th>
            <th class="buttons"></th>
            <th class="buttons"></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="title">Title</td>
            <td>
              <button class="accordion">Description</button>
              <div class="panel">
                <p>
                  Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed
                  do eiusmod tempor incididunt ut labore et dolore magna aliqua.
                  Ut enim ad minim veniam, quis nostrud exercitation ullamco
                  laboris nisi ut aliquip ex ea commodo consequat.
                </p>
              </div>
            </td>
            <td>Part</td>
            <td class="assigned">Assignee</td>
            <td class="buttons">
              <button class="button-style" onclick="editFunction()">
                Edit
              </button>
            </td>
            <td class="buttons">
              <button class="button-style" onclick="deleteFunction()">
                Delete
              </button>
            </td>
          </tr>

          <!-- Populate this section with your task data using server-side rendering or JavaScript -->
        </tbody>
      </table>
    </div>

    <script type="text/javascript" charset="utf-8">
      // Function to submit a task on submit button click event to the server.
      function submitReport() {
        fetch("/add", {
          method: "POST",
          body: JSON.stringify({
            title: document.getElementById("title").innerText,
            description: document.getElementById("description").innerText,
            Part: document.getElementById("Part").innerText,
            Assigned: document.getElementById("assigned").innerText,
            id: document.getElementById("task").taskid,
          }),
          headers: {
            "Content-type": "application/json; charset=UTF-8",
          },
        });
      }

      // TODO: complete functionality
      function editFunction() {
        // Add's edit functionality
        alert("Edit clicked!");
      }

      // AJAX call to server to delete a task gien the id of the task
      // TODO: Test Functionality
      function deleteFunction() {
        fetch("/delete", {
          method: "DELETE",
          body: JSON.stringify({
            id: document.getElementById("task").dataid,
          }),
          headers: {
            "Content-type": "application/json; charset=UTF-8",
          },
        });
      }

      //AJAX call to server with search string as input
      // TODO: test functionality
      function taskSearch() {
        const mytable = document.getElementById("html-data-table");
        var input = document.getElementById("myInput");
        input.value.toUpperCase();

        fetch("https://jsonplaceholder.typicode.com/todos", {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            input: input,
          }),
        })
          .then(function (response) {
            return response.json();
          })
          .then(function (apiJsonData) {
            console.log(apiJsonData);
            renderDataInTheTable(apiJsonData);
          });

        var count = 1;
        function renderDataInTheTable(todos) {
          const mytable = document.getElementById("html-data-table");
          todos.forEach((todo) => {
            let newRow = document.createElement("tr");
            Object.values(todo).forEach((value) => {
              if (count == 2) {
                let cell = document.createElement("td");

                let button = document.createElement("button");
                button.className = "accordion";
                button.innerText = "Click to expand Description";
                cell.appendChild(button);

                let div = document.createElement("div");
                div.className = "panel";

                let paragraph = document.createElement("p");
                paragraph.innerText = "Description";
                div.appendChild(paragraph);
                cell.appendChild(div);
                newRow.appendChild(cell);
              } /*else if (count == 7) {
              let cell = document.createElement("td");
              cell.value = value;
              newRow.appendChild(cell);
              count = 1;
            }*/ else {
                let cell = document.createElement("td");
                cell.innerText = value;
                newRow.appendChild(cell);
              }
              count++;
            });

            // add the edit button to the table
            let editCell = document.createElement("td");
            editCell.innerText = "Edit";
            editCell.className = "button-style";
            editCell.onclick = () => {
              editFunction();
            };
            newRow.appendChild(editCell);

            //add the delete button to the table
            let deleteCell = document.createElement("td");
            deleteCell.innerText = "Delete";
            deleteCell.className = "button-style";
            deleteCell.onclick = () => {
              deleteFunction();
            };
            newRow.appendChild(deleteCell);

            // adds the accordion dropdown functionality to the table
            var acc = document.getElementsByClassName("accordion");
            var i;

            for (i = 0; i < acc.length; i++) {
              acc[i].addEventListener("click", function () {
                this.classList.toggle("active");
                var panel = this.nextElementSibling;
                if (panel.style.maxHeight) {
                  panel.style.maxHeight = null;
                } else {
                  panel.style.maxHeight = panel.scrollHeight + "px";
                }
              });
            }

            mytable.appendChild(newRow);
          });
        }
      }

      // TODO: correct url
      // TODO: test functionality
      function populateParts() {
        fetch("https://jsonplaceholder.typicode.com/todos")
          .then(function (response) {
            return response.json();
          })
          .then(function (apiJsonData) {
            console.log(apiJsonData);
            renderDataInDropdown(apiJsonData);
          });

        function renderDataInDropdown(data) {
          var count = 1;
          const mydropdown = document.getElementById("Part");
          data.forEach((data) => {
            let newOption = document.createElement("option");
            Object.values(todo).forEach((value) => {
              if (count == 1) {
                newOption.partid = value;
              } else if (count == 2) {
                newOption.partnumber = value;
              } else {
                newOption.innerText = value;
              }
              count++;
            });
            mydropdown.appendChild(newOption);
            count = 1;
          });
        }
      }

      // TODO: correct url
      // TODO: correct test functinoality
      function populateUsers() {
        fetch("https://jsonplaceholder.typicode.com/todos")
          .then(function (response) {
            return response.json();
          })
          .then(function (apiJsonData) {
            console.log(apiJsonData);
            renderDataInDropdown(apiJsonData);
          });

        function renderDataInDropdown(data) {
          const mydropdown = document.getElementById("asignusers");
          data.forEach((data) => {
            let newOption = document.createElement("option");
            newOption.innerText = data;
            mydropdown.appendChild(newOption);
          });
        }
      }

      var acc = document.getElementsByClassName("accordion");
      var i;

      //function for accordian dropdown
      for (i = 0; i < acc.length; i++) {
        acc[i].addEventListener("click", function () {
          this.classList.toggle("active");
          var panel = this.nextElementSibling;
          if (panel.style.maxHeight) {
            panel.style.maxHeight = null;
          } else {
            panel.style.maxHeight = panel.scrollHeight + "px";
          }
        });
      }

      //function for search bar to only work on click
      const input = document.getElementById("myInput");
      input.addEventListener("keyup", (event) => {
        if (event.key === "Enter") {
          taskSearch();
        }
      });

      //function to implement search bar functionality (Fallback functionality)
      /* function myFunction() {
        // Declare variables
        var input,
          filter,
          table,
          tr,
          title,
          assignee,
          Part,
          description,
          i,
          titleTxtValue,
          descriptionTxtValue,
          PartTxtValue,
          assigneeTxtValue;
        input = document.getElementById("myInput");
        filter = input.value.toUpperCase();
        table = document.getElementById("html-data-table");
        tr = table.getElementsByTagName("tr");

        // Loop through all table rows titles, and hide those who don't match the search query
        for (i = 0; i < tr.length; i++) {
          title = tr[i].getElementsByTagName("td")[0];
          description = tr[i].getElementsByTagName("td")[1];
          Part = tr[i].getElementsByTagName("td")[2];
          assignee = tr[i].getElementsByTagName("td")[3];
          if (title) {
            titleTxtValue = title.textContent || title.innerText;
            descriptionTxtValue =
              description.textContent || description.innerText;
            PartTxtValue = Part.textContent || Part.innerText;
            assigneeTxtValue = assignee.textContent || assignee.innerText;
            if (
              titleTxtValue.toUpperCase().indexOf(filter) > -1 ||
              descriptionTxtValue.toUpperCase().indexOf(filter) > -1 ||
              PartTxtValue.toUpperCase().indexOf(filter) > -1 ||
              assigneeTxtValue.toUpperCase().indexOf(filter) > -1
            ) {
              tr[i].style.display = "";
            } else {
              tr[i].style.display = "none";
            }
          }
        }
      }*/
    </script>

    <script type="text/javascript" charset="utf-8">
      fetch("https://jsonplaceholder.typicode.com/todos")
        .then(function (response) {
          return response.json();
        })
        .then(function (apiJsonData) {
          console.log(apiJsonData);
          renderDataInTheTable(apiJsonData);
        });

      var count = 1;
      function renderDataInTheTable(todos) {
        const mytable = document.getElementById("html-data-table");
        todos.forEach((todo) => {
          let newRow = document.createElement("tr");
          Object.values(todo).forEach((value) => {
            if (count == 2) {
              let cell = document.createElement("td");

              let button = document.createElement("button");
              button.className = "accordion";
              button.innerText = "Click to expand Description";
              cell.appendChild(button);

              let div = document.createElement("div");
              div.className = "panel";

              let paragraph = document.createElement("p");
              paragraph.innerText = "Description";
              div.appendChild(paragraph);
              cell.appendChild(div);
              newRow.appendChild(cell);
            } /*else if (count == 7) {
              let cell = document.createElement("td");
              cell.value = value;
              newRow.appendChild(cell);
              count = 1;
            }*/ else {
              let cell = document.createElement("td");
              cell.innerText = value;
              newRow.appendChild(cell);
            }
            count++;
          });

          // add the edit button to the table
          let editCell = document.createElement("td");
          editCell.innerText = "Edit";
          editCell.className = "button-style";
          editCell.onclick = () => {
            editFunction();
          };
          newRow.appendChild(editCell);

          //add the delete button to the table
          let deleteCell = document.createElement("td");
          deleteCell.innerText = "Delete";
          deleteCell.className = "button-style";
          deleteCell.onclick = () => {
            deleteFunction();
          };
          newRow.appendChild(deleteCell);

          // adds the accordion dropdown functionality to the table
          var acc = document.getElementsByClassName("accordion");
          var i;

          for (i = 0; i < acc.length; i++) {
            acc[i].addEventListener("click", function () {
              this.classList.toggle("active");
              var panel = this.nextElementSibling;
              if (panel.style.maxHeight) {
                panel.style.maxHeight = null;
              } else {
                panel.style.maxHeight = panel.scrollHeight + "px";
              }
            });
          }

          mytable.appendChild(newRow);
        });
      }
    </script>
  </body>
</html>
